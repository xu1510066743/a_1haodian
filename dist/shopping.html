<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/commont.css"/>
		<link rel="stylesheet" type="text/css" href="css/shopping.css"/>
		<link rel="stylesheet" type="text/css" href="font/iconfont.css"/>
		<script src="js/jquery-1.11.0.js" type="text/javascript" charset="utf-8"></script>		
		
		<script src="js/jquery.cookie.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
			<div class="head_wrap">
				<div class="head">
					<div class="header_L">
						<a href="index.html"><span class="iconfont">&#xe6a5;</span><span>1号店首页</span></a>
					</div>
					
					<div class="header_R">
						<ul>
							<li>
								<a href="login.html"><span>中午好,请</span><span>登录</span></a>
								<a href="register.html"><span>注册</span></a>
								<a href=""><span class="iconfont icon-03"></span><span>会员俱乐部</span></a>
								<a href=""><span class="iconfont icon-weibiaoti104"></span><span>我的订单</span></a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			
			
			
			<div class="wrap">
				<div class="content-1">
					<div class="content-1l">
						<img src="images/c2logo.jpg" />
						<div class="">
								<span>送货至:</span>
						
							<select>
								<option>河南</option>
								<option>河北</option>
								<option>湖南</option>
								<option>湖北</option>
								
							</select>
							<select>
								<option>郑州市</option>
								<option>北京市</option>
								<option>长沙市</option>
								<option>武汉市</option>
							</select>						
							<input type="text" name="" id="" value="" placeholder="请输入详细地址"/>
						</div>
						
					</div>
					<div class="content-1r">
						<input type="text" name="" id="" value="" placeholder="请输入关键词"/><i class="iconfont icon-sousuo"></i>
					</div>
				</div>
				<div class="content">
					<span><input type="checkbox" />全选</span>
					<span>商品信息</span>
					<span>单价</span>
					<span>数量</span>
					<span>小计</span>
					<span>操作</span>
				</div>
				<div class="content-2">
					<ul id="list">
						<!--<li>
							<img src="images/e_76.jpg"/>
							<span>名字</span>
							<span>价格</span>
							<span>数量：</span>
							<input type="number" class="spinnerExample" value="1" min='1'>
							<span>总价</span>
						</li>-->
					</ul>
				</div>
				<div class="content-3">
					<div class="content-3l">
						<p>共件</p>
					</div>
					<div class="content-3r">
						<span>合计</span>
						<a href="register.html">去结算</a>
					</div>
				</div>
			</div>
			
					<div class="foot-wrap">
			<div class="foot-t">
				<ul>
					<li><img src="images/a_66.jpg"/><div><p>正品保障</p><p>正品行货 放心选购</p></div></li>
					<li><img src="images/a_66.jpg"/><div><p>正品保障</p><p>正品行货 放心选购</p></div></li>
					<li><img src="images/a_66.jpg"/><div><p>正品保障</p><p>正品行货 放心选购</p></div></li>
					<li><img src="images/a_66.jpg"/><div><p>正品保障</p><p>正品行货 放心选购</p></div></li>
				</ul>
			</div>
			<div class="foot-c">
				<div class="foot-cl">
					<dl>
						<dt>新手入门</dt>
						<dd><a href="">购物流程</a></dd>
						<dd><a href="">会员制度</a></dd>
						<dd><a href="">订单查询</a></dd>
						<dd><a href="">服务协议及隐私说明</a></dd>
						<dd><a href="">网站地图</a></dd>
					</dl>
					<dl>
						<dt>支付方式</dt>
						<dd><a href="">货到付款</a></dd>
						<dd><a href="">网上支付</a></dd>
						<dd><a href="">礼品卡支付</a></dd>
						<dd><a href="">其他支付</a></dd>						
					</dl>
					<dl>
						<dt>配送服务</dt>
						<dd><a href="">配送进度服务</a></dd>
						<dd><a href="">商品验货与签收</a></dd>
								
					</dl>
					<dl>
						<dt>售后服务</dt>
						<dd><a href="">退换货政策</a></dd>
						<dd><a href="">发票制度</a></dd>
						<dd><a href="">帮助中心</a></dd>
									
					</dl>
				</div>
				<div class="foot-cr">
					<div class="foot-crl">
						<p>APP更优惠</p>
						<a href=""><img src="images/er2.png"/></a>
					</div>
					<div class="foot-crr">
						<p>加微信差订单</p>
						<a href=""><img src="images/er3.jpg"/></a>
					</div>
				</div>
			</div>
			<div class="foot-b">
				<p><a href="">沪ICP备16050468号</a>|
					<a href="">经营证照</a>|
					<a href="">互联网药品信息服务资格证</a>|
					<a href="">违法和不良信息举报电话：0527-88100253</a>|
					<a href="">沪B2-20170039</a>|
					<a href="">沪公网安备 31010502002939号</a>|
					<a href="">友情链接</a>|
					<a href="">出版物经营许可证</a>
				</p>
				<p>Copyright© 1号店网上超市 2007-2018，All Rights Reserved</p>
				<div class="foot-bb">
					<a href=""><img src="images/a_31.jpg"/></a>
					<a href=""><img src="images/a_31.jpg"/></a>
					<a href=""><img src="images/a_31.jpg"/></a>
					<a href=""><img src="images/a_31.jpg"/></a>
					<a href=""><img src="images/a_31.jpg"/></a>
					<a href=""><img src="images/a_20.png"/></a>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			$(function(){
				var token=$.cookie("token")
				//var token=location.search.replace("?","");
				$.get("http://47.104.244.134:8080/cartlist.do",{token:token},function(data){
					console.log(data)
					var str="";
					for(var i=0;i<data.length;i++){
						str+=`<li id=${data[i].id} gid=${data[i].gid}>
							<img src="${data[i].goods.picurl}" class="pic"/>
							<span class="title">${data[i].goods.name}</span>
							<span class="he">￥${data[i].goods.price}</span>
							<span>
								<em class="iconfont min">&#xe624;</em>
								<p>${data[i].count}</p>
								<em class="iconfont max">&#xe61c;</em>
							</span>
							<span class="zh">￥${data[i].goods.price*data[i].count}</span>
							<span ><em class="rem">删除</em></span>
						</li>
						
						`;
						
						
					}
					$("#list").html(str);
					$(".pic,.title").click(function(){
						
						var gid=$(this).parents("li").attr("gid");
						//console.log(gid)
						location.href=`detailspafe.html?id=${gid}`;
					})
					
					
	
			
					
		$(".min").click(function() {
			//console.log(this);
			var target = $(this).parent().parent();

			var mon = target.find(".zh").html();
			//console.log(mon);
			var permon = target.find(".he").html();
			var abc = mon - permon;
			target.find(".zh").html(abc);
			var id = target.attr("id");
			var gid = target.attr("gid");
			var count = $(this).parent().parent().find("p").html();
			
			$.get("http://47.104.244.134:8080/cartupdate.do", {
				id: id,
				gid: gid,
				num: -1,
				token: token
			}, function(data) {
				
				count--;
				//console.log(target.find(".shu"));
				target.find("p").html(count);
				
				//console.log($(".shu"));
				if(count == 0) {
					$.get("http://47.104.244.134:8080/cartupdate.do", {
						id: id,
						gid: gid,
						num: 0,
						token: token
					}, function(data) {
						target.remove()
						
					})
				}

		

			})
		})
		$(".max").click(function() {
			var target1 = $(this).parent().parent();
			var mon = parseInt(target1.find(".zh").html());
			var permon = parseInt(target1.find(".he").html());
			var abc = mon + permon;
			target1.find(".zh").html(abc);
			var id = target1.attr("id");
			var gid = target1.attr("gid");
			var count = $(this).parent().parent().find("p").html();

			$.get("http://47.104.244.134:8080/cartupdate.do", {
				id: id,
				gid: gid,
				num: 1,
				token: token
			}, function(data) {
				count++;
				console.log(target1.find("p"));
				target1.find("p").html(count);
				doAdd();
			})

		})
		$(".rem").click(function() {
			var target2 = $(this).parent().parent();
			console.log(target2);
			//target2.remove();

			var id = target2.attr("id");
			var gid = target2.attr("gid");
			$.get("http://47.104.244.134:8080/cartupdate.do", {
				id: id,
				gid: gid,
				num: 0,
				token: token
			}, function(data) {
				target2.remove()
				//location.reload();
			})
		})
/*										
					$(".min,.max,.rem").click(function(e){
						//location.reload()
						var target=e.target;
						if(target.className=="iconfont max"){
							var num=1;
							
						}else if(target.className=="iconfont min"){
							var num=-1;
							
						}else if(target.className=="rem"){
							var num=0;
							
						}else{
							return;
						}
						var id=$(this).parents("li").attr("id");
						var gid=$(this).parents("li").attr("gid");
						//console.log(gid)
						$.get("http://47.104.244.134:8080/cartupdate.do",{id:id,gid:gid,num:num,token:token},function(data){
							console.log(data);
							
							if(data.code==0){
								var a=Number($(target).parent().find("p").html());
								console.log(a)
								$(target).parent().find("p").html(a+num);
								var b=Number($(target).parent().find("p").html())
								var c=Number($(target).parent().siblings(".he").html());
								$(target).parent().next().html(b*c);
								if(a+num<=0){
									$.get("http://47.104.244.134:8080/cartupdate.do",{id:id,gid:gid,num:0,token:token},function(data){
										$(target).parents("li").remove();
									});
									
									
								}
							}else{
								alert("操作失败,请重试");
							}
							
							
						})
					})*/
				})
			})
		</script>
	</body>
</html>
